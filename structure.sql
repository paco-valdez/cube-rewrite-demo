-- example_schema
\timing off
\pset null ''
\x off
\pset pager
\set ON_ERROR_STOP on
\set QUIET 1

begin;
-- drop schema if exists public cascade;
create schema if not exists public;
set search_path to public;

create table if not exists organizations (
  id integer primary key generated by default as identity,
  name text
);

create table if not exists hcps (
  npi integer primary key generated by default as identity,
  name text
);

create table if not exists products (
  id text primary key,
  name text
);

create table if not exists zipcode_location (
  zip integer primary key generated by default as identity
, city text
, state varchar(3)
);

create table if not exists site_of_care_parent (
  soc_id integer primary key generated by default as identity
, name text
, soc_type integer
, postal_code integer
, state varchar(3)
, annual_utilizations integer
, latitude float
, longitude float
);

create table if not exists utilization_opportunity_materialized_value (
  soc_id integer
, npi integer references hcps
, product_id text references products
, org_id integer not null references organizations
, volume integer
, opp_value float
, PRIMARY KEY (soc_id, npi, product_id)
);

commit;

begin;

insert into organizations (id, name) values
  (1, 'Organization A')
, (2, 'Organization B')
on conflict do nothing;


insert into hcps (npi, name) values
  (11111, 'Clinic A')
, (22222, 'Hospital B')
on conflict do nothing;

insert into products (id, name) values
  ('5', 'Product 1')
, ('2', 'Product 2')
on conflict do nothing;

insert into zipcode_location (zip, city, state) values
  (10019, 'New York', 'NY')
, (10018, 'New York', 'NY')
on conflict do nothing;

insert into site_of_care_parent (soc_id, soc_type, name, postal_code, state, latitude, longitude, annual_utilizations) values
  (1, 1, 'Acme', 10019, 'NY', 40.76453102029356, -73.99246168967653, 100)
, (2, 1, 'National', 10019, 'NY', 40.763099427311666, -73.98532537972713, 200)
, (3, 1, 'Empty', 10018, 'NY', 40.75542972221631, -73.99461421529168, 100)
on conflict do nothing;

insert into utilization_opportunity_materialized_value (soc_id, npi, product_id, org_id, volume, opp_value) values
  (1,11111,'5', 1, 100, 10000.00)
, (1,11111,'2', 2, 200, 20000.00)
, (2,11111,'5', 1, 302, 30200.00)
, (3,22222,'2', 1, 404, 40400.00)
on conflict do nothing;

commit;
\d
